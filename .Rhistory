# Chunk 9
PRJ %>%
mutate(
annee_debut = lubridate::year(date_debut),
annee_fin = lubridate::year(date_fin)
) %>%
group_by(annee_fin) %>%
count(type) %>%
spread(key = annee_fin, value = n) %>%
ungroup() %>%
mutate_at(vars(`2017`:`2025`), replace_na, 0)
# Chunk 10
par_an <- PRJ %>%
mutate(
annee_debut = lubridate::year(date_debut),
annee_fin = lubridate::year(date_fin)
)
l <- list()
for (i in 2014:2020) {
l[[as.character(i)]] <- par_an %>%
filter(annee_debut <= i & annee_fin >= i) %>%
mutate(an = i)
}
count_type <- function(df) {
df %>%
group_by(type, an) %>%
count() %>%
arrange(desc(n))
}
map(l, count_type) %>%
bind_rows() %>%
spread(key = an, value = n) %>%
ungroup() %>%
mutate_at(vars(`2014`:`2020`), replace_na, 0)
# Chunk 11
acl1 <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
mutate(year = stringr::str_extract(reference_complete, "\\d{4}")) %>%
drop_na(year) %>%
group_by(year) %>%
summarise(n = n_distinct(reference_complete)) %>%
spread(key = year, value = n) %>%
mutate(Type = "Articles")
acl2 <- ANX4$i_1_autres_articles %>%
clean_names() %>%
mutate(year = stringr::str_extract(reference_complete, "\\d{4}")) %>%
filter(year != 2016) %>%
drop_na(year) %>%
group_by(year) %>%
summarise(n = n_distinct(reference_complete)) %>%
spread(key = year, value = n) %>%
mutate(Type = "Autres articles")
acl3 <- ANX4$i_3_articles_actes_colloq %>%
clean_names() %>%
mutate(year = stringr::str_extract(reference_complete, "\\d{4}")) %>%
drop_na(year) %>%
group_by(year) %>%
summarise(n = n_distinct(reference_complete)) %>%
spread(key = year, value = n) %>%
mutate(Type = "Actes colloques")
acl4 <- ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
mutate(year = stringr::str_extract(reference_complete, "\\d{4}")) %>%
drop_na(year) %>%
group_by(year) %>%
summarise(n = n_distinct(reference_complete)) %>%
spread(key = year, value = n) %>%
mutate(Type = "Chapitres ouvrages")
bind_rows(acl1, acl2, acl3, acl4) %>%
select(Type, `2017`:`2020`)
# Chunk 12
nb_art_ang <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(articles_scientifiques_en_anglais_ou_dans_une_autre_langue_etrangere_shs_uniquement == "x") %>%
nrow()
# ANX4$i_1_autres_articles %>%
#   clean_names() %>%
#   filter(autres_articles_articles_publies_dans_des_revues_professionnelles_ou_techniques_etc_en_anglais_ou_dans_une_autre_langue_etrangere_shs_uniquement == "x") %>%
#   nrow()
nb_ouv_ang <- ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
filter(chapitres_d_ouvrage_en_anglais_ou_dans_une_autre_langue_etrangere == "x") %>%
nrow()
# Chunk 13
clean_revues <- function(x) {
r <- case_when(
x == "water research, elsevier" ~ "water research",
x == "water resources research, agu" ~ "water resources research",
x == "water, mdpi journal" ~ "water",
x == "water science and technology: water supply, iwa" ~ "water science and technology: water supply",
x == "vertigo - la revue électronique en sciences de l'environnement 1" ~ "vertigo",
x == "revue internationale des etudes du développement" ~ "revue internationale des etudes du developpement",
x == "journal of hydroinformatics, iwa" ~ "journal of hydroinformatics",
x == TRUE ~ x
)
if (is.na(r)) {
return(x)
}
return(r)
}
word_count <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
mutate(journal = clean_revues(journal)) %>%
group_by(journal) %>%
count() %>%
arrange(desc(n)) %>%
ungroup() %>%
rowwise() %>%
mutate(n = ifelse(journal == "Journal of Water Resources Planning and Management", yes = 7, no = n)) %>%
mutate(journal = ifelse(journal == "Journal of Water Resources Planning and Management", yes = "Water Res. Planning and Management", no = journal)) %>%
ungroup() %>%
mutate(journal = str_to_lower(journal)) %>%
mutate(journal = str_trim(journal))
# wordcloud2(word_count, size = 0.35)
# Chunk 14
articles <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
mutate(journal = clean_revues(journal)) %>%
group_by(journal) %>%
count() %>%
arrange(desc(n)) %>%
mutate(journal = str_to_lower(journal)) %>%
mutate(journal = str_trim(journal))
tab_relecture_articles <- ANX4$i_8_evaluation_articles %>%
clean_names() %>%
select(revue_ouvrage, nombre_de_relectures) %>%
mutate(revue_ouvrage = str_to_lower(revue_ouvrage)) %>%
mutate(revue_ouvrage = str_trim(revue_ouvrage)) %>%
full_join(articles, by = c("revue_ouvrage" = "journal")) %>%
arrange(revue_ouvrage) %>%
unique() %>%
mutate(revue_ouvrage = clean_revues(revue_ouvrage)) %>%
group_by(revue_ouvrage) %>%
summarise(n_relecture = sum(nombre_de_relectures, na.rm = TRUE), n_publi = sum(n, na.rm = TRUE)) %>%
ungroup() %>%
unique()
# Chunk 15
tab_relecture_articles %>%
mutate(diff = abs(n_publi - n_relecture)) %>%
filter(diff > 1) %>%
ggplot(aes(x = reorder(revue_ouvrage, -n_publi))) +
geom_segment(aes(
x = reorder(revue_ouvrage, -n_publi), xend = reorder(revue_ouvrage, -n_publi),
y = n_publi, yend = n_relecture
)) +
geom_point(aes(y = n_publi, fill = "Nombre de publications"), color = "black", shape = 21, size = 4, alpha = 0.8) +
geom_point(aes(y = n_relecture, fill = "Nombre de relectures"), color = "black", shape = 21, size = 4, alpha = 0.8) +
theme_inrae() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(x = "Revues", y = "Nombre", fill = "Type") +
scale_y_continuous(breaks = seq(0, 30, 2)) +
labs(caption = "NB : par souci de lisibilité, seules les revues pour lesquelles la différence entre les deux variables est supérieure à 1 sont affichées")
# Chunk 16
HAL <- jsonlite::fromJSON("data/ETBX_2017_2020.json")$response$docs %>% tibble()
# Chunk 17
base_doi <- HAL %>%
drop_na(doiId_s) %>%
distinct(doiId_s)
## On crée la requête
# base_doi %>%
#   mutate(request = paste0("DOI(",doiId_s,")")) %>%
#   pull(request) %>%
#   paste0(collapse = " OR ")
# Chunk 18
read_csv("data/scopus.csv") %>%
clean_names() %>%
group_by(year) %>%
summarise(n_citations = sum(cited_by, na.rm = TRUE)) %>%
select(`Année` = year, n_citations)
# Chunk 19
table_auteurs <- readxl::read_excel("data/Table_auteurs_ETBX_2020-08-17_BH.xlsx") %>% clean_names()
liste_auteurs_etbx <- table_auteurs %>%
filter(etbx_oui_non %in% c("oui", "temporaire", "oui / BSA")) %>%
pull(auteur)
# Chunk 20
calcul_nb_copubli <- function(x) {
liste_auteurs_etbx[str_detect(x, liste_auteurs_etbx)] %>%
gsub("^\\.|\\.$", "", .) %>%
unique() %>%
length()
}
tab_copubli <- bind_rows(
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
ungroup() %>%
arrange(desc(nb_copubli)),
ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
ungroup() %>%
arrange(desc(nb_copubli))
) %>%
filter(nb_copubli > 1)
#
# ggplot(tab_copubli, aes(x = nb_copubli)) +
#   geom_histogram(fill = "#00a3a6", color = "black", binwidth = 1) +
#   theme_inrae() +
#   scale_y_continuous(breaks = seq(0, 40, 2)) +
#   labs(x = "Nombre de co-auteurs ETBX sur une production scientifique", y = "Fréquence")
tab_copubli %>% count(nb_copubli) %>% rename("Nombre de co-auteurs ETBX sur une production scientifique"="nb_copubli","Fréquence"="n")
# Chunk 21
word_count <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete, journal) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
ungroup() %>%
mutate(journal = clean_revues(journal)) %>%
group_by(journal) %>%
summarise(nb_moyen = mean(nb_copubli)) %>%
ungroup() %>%
arrange(desc(nb_moyen))
# wordcloud2(word_count, size = 0.35)
# Chunk 22: categ_jcr
liste_revues_jcr <- list()
for (i in list.files("data/revues")) {
nom <- str_remove_all(i, ".csv")
liste_revues_jcr[[nom]] <- read_csv(file.path("data/revues/", i), skip = 1) %>%
tibble() %>%
janitor::clean_names() %>%
select(full_journal_title, total_cites, journal_impact_factor) %>%
mutate(
total_cites = as.numeric(total_cites),
journal_impact_factor = as.numeric(journal_impact_factor)
) %>%
mutate(CATEGORY = nom)
}
table_jcr <- bind_rows(liste_revues_jcr) %>%
mutate(full_journal_title = str_to_lower(full_journal_title)) %>%
unique()
# tab_relecture_articles$revue_ouvrage[tab_relecture_articles$revue_ouvrage %in% table_jcr$full_journal_title]
# Chunk 23
tab_relecture_articles %>%
inner_join(table_jcr, by = c("revue_ouvrage" = "full_journal_title")) %>%
group_by(CATEGORY) %>%
count() %>%
ungroup() %>%
ggplot(aes(x = reorder(CATEGORY, n), y = n)) +
geom_col(fill = "#00a3a6", color = "black") +
geom_label(aes(label = n)) +
coord_flip() +
theme_inrae() +
labs(y = "Nombre de publications", x = "Catégorie JCR")
# Chunk 24
table_disciplines_auteurs <- table_auteurs %>%
filter(etbx_oui_non %in% c("oui", "temporaire", "oui / BSA")) %>%
select(auteur, discipline) %>%
drop_na()
calcul_discipline <- function(x) {
df <- data.frame(auteur = liste_auteurs_etbx[str_detect(x, liste_auteurs_etbx)] %>% gsub("^\\.|\\.$", "", .) %>% unique())
df %>%
inner_join(table_disciplines_auteurs, by = "auteur") %>%
pull(discipline) %>%
unique() %>%
paste(collapse = " / ")
}
tab_disciplines <- bind_rows(
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(disciplines = calcul_discipline(reference_complete)) %>%
mutate(nb_disciplines = str_split(disciplines, " / ")[[1]] %>% length()) %>%
ungroup(),
ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(disciplines = calcul_discipline(reference_complete)) %>%
mutate(nb_disciplines = str_split(disciplines, " / ")[[1]] %>% length()) %>%
ungroup()
) %>% filter(nb_disciplines > 1)
tab_disciplines %>%
count(nb_disciplines) %>%
rename("Nombre de disciplines impliquées sur une production scientifique" = "nb_disciplines","Fréquence"="n")
# ggplot(tab_disciplines, aes(x = nb_disciplines)) +
#   geom_histogram(fill = "#00a3a6", color = "black", binwidth = 1) +
#   theme_inrae() +
#   scale_y_continuous(breaks = seq(0, 40, 2)) +
#   labs(x = "Nombre de disciplines impliquées sur une production scientifique", y = "Fréquence")
# Chunk 25
mono_dis <- bind_rows(
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
mutate(disciplines = calcul_discipline(reference_complete)) %>%
mutate(nb_disciplines = str_split(disciplines, " / ")[[1]] %>% length()),
ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
mutate(disciplines = calcul_discipline(reference_complete)) %>%
mutate(nb_disciplines = str_split(disciplines, " / ")[[1]] %>% length())
) %>%
filter(nb_copubli > 1 & nb_disciplines == 1)
# Chunk 26
solo <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
filter(nb_copubli == 1)
# Chunk 27
HAL <- jsonlite::fromJSON("data/ETBX_2017_2020.json")$response$docs %>% tibble()
HAL %>%
filter(docType_s %in% c("ART", "COUV")) %>%
rowwise() %>%
mutate(Acronymes = list(c(c_across(contains("Acronym"))))) %>%
mutate(Noms = list(c(c_across(contains("StructName"))))) %>%
mutate(Pays = list(c(c_across(contains("Country"))))) %>%
pull(Noms) %>%
unlist() %>%
unique() -> structures
HAL %>%
count(docType_s) %>%
select(Type = docType_s, N = n)
# Chunk 28
table_collab <- readxl::read_excel("data/Structures_Collab_BH.xlsx") %>% clean_names()
# Chunk 29
table_collab %>% count(pays) %>% arrange(desc(n)) %>% drop_na() %>% top_n(10)
# Chunk 30
HAL %>%
filter(docType_s %in% c("ART", "COUV")) %>%
rowwise() %>%
mutate(Acronymes = list(c(c_across(contains("Acronym"))))) %>%
mutate(Noms = list(c(c_across(contains("StructName"))))) %>%
mutate(Pays = list(c(c_across(contains("Country"))))) %>%
pull(Noms) %>%
unlist() -> aa
data.frame(structure = aa) %>% count(structure) %>% filter(n > 5) %>% arrange(desc(n))
RH_data <- readxl::read_excel("data/Personnels.xlsx") %>%
gather(key = annee, value = n, -Equipe,-Statut)
RH_data %>%
ggplot(aes(x = annee, y = n)) +
geom_col(aes(fill = Statut), color = "black") +
facet_wrap(~Equipe) +
theme_inrae() +
scale_fill_brewer(palette = "Set3") +
scale_y_continuous(breaks = seq(0,65,5)) +
labs(y = "Effectifs") +
theme(axis.title.x = element_blank())
ress <- read_excel("data/financements.xlsx") %>%
gather(key = annee, value = financement, -Type) %>% mutate(Type = recode(Type, "Fondations, associations caritatives, Institut Carnot, RTRA, RTRS
"="Fondations, associations caritatives,\n Institut Carnot, RTRA, RTRS
"))
ress %>% group_by(annee) %>% mutate(prop = financement / sum(financement)) %>% ungroup() %>%
ggplot(aes(x = reorder_within(Type,prop,annee), y = prop)) +
geom_col(aes(fill = Type), color = "black") +
scale_x_reordered(name = "Proportion") +
guides(fill = FALSE) +
geom_label(aes(label = paste0(round(prop*100),"%"))) +
facet_wrap(~annee, drop = TRUE, scales = "free_y", ncol = 1) +
scale_y_continuous(labels = scales::label_percent(1)) +
theme_inrae() +
coord_flip() +
theme(axis.text.x = element_text(angle = 90)) +
labs(y = "Proportion") +
theme(axis.title.y = element_blank())  +
scale_fill_brewer(palette = "Set3")
dis <- read_excel("data/Disciplines.xlsx") %>%
mutate(Discipline = recode(Discipline, "eco"="Economie","stat"="Statistiques","geo"="Géographie","socio"="Sociologie","agro"="Agronomie","scpo"="Science politique","SPI"="Sciences pour l'ingénieur")) %>%
group_by(Discipline,Statut) %>%
summarise(n = n_distinct(Nom)) %>%
ungroup() %>%
mutate(Statut = factor(Statut, levels = rev(c("Chercheurs","Doctorants et post-doctorants","HDR"))))
ggplot(dis, aes(x = Discipline, y = n)) +
geom_col(aes(fill = Statut), color = "black") +
coord_flip() +
scale_y_continuous(breaks = seq(0,15,2)) +
theme_inrae() +
scale_fill_brewer(palette = "OrRd",guide = guide_legend(reverse = TRUE)) +
theme(axis.title.y =element_blank()) +
labs(y = "Effectifs")
dis <- read_excel("data/Disciplines.xlsx") %>%
mutate(Discipline = recode(Discipline, "eco"="Economie","stat"="Statistiques, Mathématiques et Informatique","geo"="Géographie","socio"="Sociologie","agro"="Agronomie","scpo"="Sciences politiques","SPI"="Sciences pour l'ingénieur et hydraulique")) %>%
mutate(Statut = recode(Statut, "Chercheur"="Agents permanents")) %>%
group_by(Discipline,Statut) %>%
summarise(n = n_distinct(Nom)) %>%
ungroup() %>%
mutate(Statut = factor(Statut, levels = rev(c("Agents permanents","HDR","Doctorants et post-doctorants"))))
ggplot(dis, aes(x = Discipline, y = n)) +
geom_col(aes(fill = Statut), color = "black") +
coord_flip() +
scale_y_continuous(breaks = seq(0,15,2)) +
theme_inrae() +
scale_fill_brewer(palette = "OrRd",guide = guide_legend(reverse = TRUE)) +
theme(axis.title.y =element_blank()) +
labs(y = "Effectifs")
dis <- read_excel("data/Disciplines.xlsx") %>%
mutate(Discipline = recode(Discipline, "eco"="Economie","stat"="Statistiques, Mathématiques et Informatique","geo"="Géographie","socio"="Sociologie","agro"="Agronomie","scpo"="Sciences politiques","SPI"="Sciences pour l'ingénieur et hydraulique")) %>%
mutate(Statut = recode(Statut, "Chercheurs"="Agents permanents")) %>%
group_by(Discipline,Statut) %>%
summarise(n = n_distinct(Nom)) %>%
ungroup() %>%
mutate(Statut = factor(Statut, levels = rev(c("Agents permanents","HDR","Doctorants et post-doctorants"))))
ggplot(dis, aes(x = Discipline, y = n)) +
geom_col(aes(fill = Statut), color = "black") +
coord_flip() +
scale_y_continuous(breaks = seq(0,15,2)) +
theme_inrae() +
scale_fill_brewer(palette = "OrRd",guide = guide_legend(reverse = TRUE)) +
theme(axis.title.y =element_blank()) +
labs(y = "Effectifs")
ggplot(dis, aes(x = Discipline, y = n)) +
geom_col(aes(fill = Statut), color = "black") +
coord_flip() +
scale_y_continuous(breaks = seq(0,15,2)) +
theme_inrae() +
scale_fill_brewer(palette = "OrRd",guide = guide_legend(reverse = TRUE), direction = -1) +
theme(axis.title.y =element_blank()) +
labs(y = "Effectifs")
ggplot(dis, aes(x = Discipline, y = n)) +
geom_col(aes(fill = Statut), color = "black") +
coord_flip() +
scale_y_continuous(breaks = seq(0,15,2)) +
theme_inrae() +
scale_fill_brewer(palette = "OrRd",guide = guide_legend(reverse = TRUE), direction = -1) +
theme(axis.title.y =element_blank()) +
labs(y = "Effectifs")  +
scale_x_continuous(breaks = seq(1,14,1))
ggplot(dis, aes(x = Discipline, y = n)) +
geom_col(aes(fill = Statut), color = "black") +
coord_flip() +
scale_y_continuous(breaks = seq(0,15,2)) +
theme_inrae() +
scale_fill_brewer(palette = "OrRd",guide = guide_legend(reverse = TRUE), direction = -1) +
theme(axis.title.y =element_blank()) +
labs(y = "Effectifs")  +
scale_y_continuous(breaks = seq(1,14,1))
ggplot(dis, aes(x = Discipline, y = n)) +
geom_col(aes(fill = Statut), color = "black") +
coord_flip() +
scale_y_continuous(breaks = seq(0,14,1)) +
theme_inrae() +
scale_fill_brewer(palette = "OrRd",guide = guide_legend(reverse = TRUE), direction = -1) +
theme(axis.title.y =element_blank()) +
labs(y = "Effectifs")
ggplot(dis, aes(x = Discipline, y = n)) +
geom_col(aes(fill = Statut), color = "black") +
coord_flip() +
scale_y_continuous(breaks = seq(0,14,2)) +
theme_inrae() +
scale_fill_brewer(palette = "OrRd",guide = guide_legend(reverse = TRUE), direction = -1) +
theme(axis.title.y =element_blank()) +
labs(y = "Effectifs")
ggplot(dis, aes(x = Discipline, y = n)) +
geom_col(aes(fill = Statut), color = "black") +
coord_flip() +
scale_y_continuous(breaks = seq(0,15,2)) +
theme_inrae() +
scale_fill_brewer(palette = "OrRd",guide = guide_legend(reverse = TRUE), direction = -1) +
theme(axis.title.y =element_blank()) +
labs(y = "Effectifs")
ress %>% group_by(annee) %>% mutate(prop = financement / sum(financement)) %>% ungroup() %>%
ggplot(aes(x = reorder_within(Type,prop,annee), y = prop)) +
geom_col(aes(fill = Type), color = "black") +
scale_x_reordered(name = "Proportion") +
guides(fill = FALSE) +
geom_label(aes(label = paste0(round(prop*100),"%"))) +
facet_wrap(~annee, drop = TRUE, scales = "free_y", ncol = 1) +
scale_y_continuous(labels = scales::label_percent(1)) +
theme_inrae() +
coord_flip() +
theme(axis.text.x = element_text(angle = 90)) +
labs(y = "Proportion") +
theme(axis.title.y = element_blank(), axis.text.x = element_blank(),axis.tick.x =element_blank(), axis.title.x = element_blank())  +
scale_fill_brewer(palette = "Set3")
ress %>% group_by(annee) %>% mutate(prop = financement / sum(financement)) %>% ungroup() %>%
ggplot(aes(x = reorder_within(Type,prop,annee), y = prop)) +
geom_col(aes(fill = Type), color = "black") +
scale_x_reordered(name = "Proportion") +
guides(fill = FALSE) +
geom_label(aes(label = paste0(round(prop*100),"%"))) +
facet_wrap(~annee, drop = TRUE, scales = "free_y", ncol = 1) +
scale_y_continuous(labels = scales::label_percent(1)) +
theme_inrae() +
coord_flip() +
theme(axis.text.x = element_text(angle = 90)) +
labs(y = "Proportion") +
theme(axis.title.y = element_blank(), axis.text.x = element_blank(),axis.ticks.x =element_blank(), axis.title.x = element_blank())  +
scale_fill_brewer(palette = "Set3")
ress %>% group_by(annee) %>% mutate(prop = financement / sum(financement)) %>% ungroup() %>%
ggplot(aes(x = reorder(Type,prop), y = prop)) +
geom_col(aes(fill = Type), color = "black") +
guides(fill = FALSE) +
geom_label(aes(label = paste0(round(prop*100),"%"))) +
facet_wrap(~annee) +
scale_y_continuous(labels = scales::label_percent(1)) +
theme_inrae() +
coord_flip() +
theme(axis.text.x = element_text(angle = 90)) +
labs(y = "Proportion") +
theme(axis.title.y = element_blank(), axis.text.x = element_blank(),axis.ticks.x =element_blank(), axis.title.x = element_blank())  +
scale_fill_brewer(palette = "Set3")
70*123
70*12
0.02*1500
30*12
1895*12
22740-21463
+24268
1277+24268
22740-6000
22740-6000+5292
