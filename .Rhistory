labs(x = "Nombre de disciplines impliquées sur une production scientifique", y = "Fréquence")
# Chunk 1: setup
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, out.width = "100%", dpi = 320)
# Chunk 2: packages
library(dplyr)
library(tidyr)
library(lubridate)
library(janitor)
library(ggplot2)
library(readxl)
library(purrr)
library(bib2df)
library(wordcloud2)
library(stringr)
library(readr)
source("R/theme_inrae.R")
# Chunk 3
# Fichier en date du 03/08/2020
file <- "data/Annexe4_ETBX_complet_2020_08_03.xlsx"
# On réalise une boucle pour importer tous les onglets dans un seul objet, sous forme de liste
sheet_names <- readxl::excel_sheets(file)
ANX4 <- list()
for (i in sheet_names[-1:-3]) {
ANX4[[i]] <- readxl::read_excel(file, sheet = i, skip = 1) %>%
select(-1) # Retrait colonne n°
}
# On rend exploitables les noms d'onglets
names(ANX4) <- janitor::make_clean_names(names(ANX4))
# Chunk 4
replace_cases <- function(x) {
value <- ifelse(is.na(x), yes = 0, no = 1)
return(value)
}
# Chunk 5
acl1 <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
mutate(year = stringr::str_extract(reference_complete, "\\d{4}")) %>%
drop_na(year) %>%
group_by(year) %>%
summarise(n = n_distinct(reference_complete)) %>%
spread(key = year, value = n) %>%
mutate(Type = "Articles")
acl2 <- ANX4$i_1_autres_articles %>%
clean_names() %>%
filter(axe_3 == "x") %>%
mutate(year = stringr::str_extract(reference_complete, "\\d{4}")) %>%
filter(year != 2016) %>%
drop_na(year) %>%
group_by(year) %>%
summarise(n = n_distinct(reference_complete)) %>%
spread(key = year, value = n) %>%
mutate(Type = "Autres articles")
acl3 <- ANX4$i_3_articles_actes_colloq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
mutate(year = stringr::str_extract(reference_complete, "\\d{4}")) %>%
drop_na(year) %>%
group_by(year) %>%
summarise(n = n_distinct(reference_complete)) %>%
spread(key = year, value = n) %>%
mutate(Type = "Actes colloques")
acl4 <- ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
filter(axe_3 == "x") %>%
mutate(year = stringr::str_extract(reference_complete, "\\d{4}")) %>%
drop_na(year) %>%
group_by(year) %>%
summarise(n = n_distinct(reference_complete)) %>%
spread(key = year, value = n) %>%
mutate(Type = "Chapitres ouvrages")
bind_rows(acl1, acl2, acl3, acl4) %>%
select(Type, `2017`:`2020`)
# Chunk 6
nb_art_ang <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
filter(articles_scientifiques_en_anglais_ou_dans_une_autre_langue_etrangere_shs_uniquement == "x") %>%
nrow()
# ANX4$i_1_autres_articles %>%
#   clean_names() %>%
#   filter(autres_articles_articles_publies_dans_des_revues_professionnelles_ou_techniques_etc_en_anglais_ou_dans_une_autre_langue_etrangere_shs_uniquement == "x") %>%
#   nrow()
nb_ouv_ang <- ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
filter(axe_3 == "x") %>%
filter(chapitres_d_ouvrage_en_anglais_ou_dans_une_autre_langue_etrangere == "x") %>%
nrow()
# Chunk 7
clean_revues <- function(x) {
r <- case_when(
x == "water research, elsevier" ~ "water research",
x == "water resources research, agu" ~ "water resources research",
x == "water science and technology: water supply, iwa" ~ "water science and technology: water supply",
x == "vertigo - la revue électronique en sciences de l'environnement 1" ~ "vertigo",
x == "revue internationale des etudes du développement" ~ "revue internationale des etudes du developpement",
x == "journal of hydroinformatics, iwa" ~ "journal of hydroinformatics",
x == TRUE ~ x
)
if (is.na(r)) {
return(x)
}
return(r)
}
word_count <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
mutate(journal = clean_revues(journal)) %>%
group_by(journal) %>%
count() %>%
arrange(desc(n)) %>%
ungroup() %>%
rowwise() %>%
mutate(n = ifelse(journal == "Journal of Water Resources Planning and Management", yes = 7, no = n)) %>%
mutate(journal = ifelse(journal == "Journal of Water Resources Planning and Management", yes = "Water Res. Planning and Management", no = journal)) %>%
ungroup() %>%
mutate(journal = str_to_lower(journal)) %>%
mutate(journal = str_trim(journal))
# wordcloud2(word_count, size = 0.35)
# Chunk 8
articles <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
mutate(journal = clean_revues(journal)) %>%
group_by(journal) %>%
count() %>%
arrange(desc(n)) %>%
mutate(journal = str_to_lower(journal)) %>%
mutate(journal = str_trim(journal))
tab_relecture_articles <- ANX4$i_8_evaluation_articles %>%
clean_names() %>%
select(revue_ouvrage, nombre_de_relectures) %>%
mutate(revue_ouvrage = str_to_lower(revue_ouvrage)) %>%
mutate(revue_ouvrage = str_trim(revue_ouvrage)) %>%
full_join(articles, by = c("revue_ouvrage" = "journal")) %>%
arrange(revue_ouvrage) %>%
unique() %>%
mutate(revue_ouvrage = clean_revues(revue_ouvrage)) %>%
group_by(revue_ouvrage) %>%
summarise(n_relecture = sum(nombre_de_relectures, na.rm = TRUE), n_publi = sum(n, na.rm = TRUE)) %>%
ungroup() %>%
unique()
# Chunk 9
tab_relecture_articles %>%
mutate(diff = abs(n_publi - n_relecture)) %>%
filter(diff > 1) %>%
ggplot(aes(x = reorder(revue_ouvrage, -n_publi))) +
geom_segment(aes(
x = reorder(revue_ouvrage, -n_publi), xend = reorder(revue_ouvrage, -n_publi),
y = n_publi, yend = n_relecture
)) +
geom_point(aes(y = n_publi, fill = "Nombre de publications"), color = "black", shape = 21, size = 4, alpha = 0.8) +
geom_point(aes(y = n_relecture, fill = "Nombre de relectures"), color = "black", shape = 21, size = 4, alpha = 0.8) +
theme_inrae() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(x = "Revues", y = "Nombre", fill = "Type") +
scale_y_continuous(breaks = seq(0, 30, 2)) +
labs(caption = "NB : par souci de lisibilité, seules les revues pour lesquelles la différence entre les deux variables est supérieure à 1 sont affichées")
# Chunk 10
tab_relecture_articles %>%
mutate(diff = abs(n_publi - n_relecture)) %>%
filter(diff > 1) %>%
ggplot(aes(x = reorder(revue_ouvrage, -n_publi))) +
geom_hline(yintercept = 0, size = 2) +
geom_segment(aes(
x = reorder(revue_ouvrage, -n_publi), xend = reorder(revue_ouvrage, -n_publi),
y = n_publi, yend = -n_relecture
)) +
geom_point(aes(y = n_publi, fill = "Nombre de publications"), color = "black", shape = 21, size = 4, alpha = 0.8) +
geom_point(aes(y = -n_relecture, fill = "Nombre de relectures"), color = "black", shape = 21, size = 4, alpha = 0.8) +
theme_inrae() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(x = "Revues", y = "Nombre", fill = "Type") +
scale_y_continuous(breaks = seq(-30, 12, 2)) +
labs(caption = "NB : par souci de lisibilité, seules les revues pour lesquelles la différence entre les deux variables est supérieure à 1 sont affichées")
# Chunk 11
table_auteurs <- readxl::read_excel("data/Table_auteurs_ETBX_2020-08-17_BH.xlsx") %>% clean_names()
liste_auteurs_etbx <- table_auteurs %>%
filter(etbx_oui_non %in% c("oui", "temporaire", "oui / BSA")) %>%
pull(auteur)
auteurs_axe3 <- c("Boschet","Caillaud","Carayon","Dachary","Gilbert","Haddane","Husson","Kuentz","Leccia", "Le Gat","Lescot","Lyser","Piller","Rambonilaza","Renaud","Rulleau","Sabatie","Salles","Sabatié","Stricker","Terreaux")
vec_axe3 <- c()
for (i in auteurs_axe3) {
vec_axe3 <- c(vec_axe3,which(str_detect(liste_auteurs_etbx,i)))
}
liste_auteurs_etbx <- liste_auteurs_etbx[vec_axe3]
liste_auteurs_etbx
# Chunk 12
calcul_nb_copubli <- function(x) {
liste_auteurs_etbx[str_detect(x, liste_auteurs_etbx)] %>%
gsub("^\\.|\\.$", "", .) %>%
unique() %>%
length()
}
tab_copubli <- bind_rows(
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
ungroup() %>%
arrange(desc(nb_copubli)),
ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
filter(axe_3 == "x") %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
ungroup() %>%
arrange(desc(nb_copubli))
) %>%
filter(nb_copubli > 1)
ggplot(tab_copubli, aes(x = nb_copubli)) +
geom_histogram(fill = "#00a3a6", color = "black", binwidth = 1) +
theme_inrae() +
scale_y_continuous(breaks = seq(0, 40, 2)) +
labs(x = "Nombre de co-auteurs ETBX de l'axe 3 sur une production scientifique", y = "Fréquence")
# Chunk 13
word_count <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
select(reference_complete, journal) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
ungroup() %>%
mutate(journal = clean_revues(journal)) %>%
group_by(journal) %>%
summarise(nb_moyen = mean(nb_copubli)) %>%
ungroup() %>%
arrange(desc(nb_moyen))
# wordcloud2(word_count, size = 0.35)
# Chunk 14: categ_jcr
liste_revues_jcr <- list()
for (i in list.files("data/revues")) {
nom <- str_remove_all(i, ".csv")
liste_revues_jcr[[nom]] <- read_csv(file.path("data/revues/", i), skip = 1) %>%
tibble() %>%
janitor::clean_names() %>%
select(full_journal_title, total_cites, journal_impact_factor) %>%
mutate(
total_cites = as.numeric(total_cites),
journal_impact_factor = as.numeric(journal_impact_factor)
) %>%
mutate(CATEGORY = nom)
}
table_jcr <- bind_rows(liste_revues_jcr) %>%
mutate(full_journal_title = str_to_lower(full_journal_title)) %>%
unique()
tab_relecture_articles$revue_ouvrage[tab_relecture_articles$revue_ouvrage %in% table_jcr$full_journal_title]
# Chunk 15
tab_relecture_articles %>%
inner_join(table_jcr, by = c("revue_ouvrage" = "full_journal_title")) %>%
group_by(CATEGORY) %>%
count() %>%
ungroup() %>%
ggplot(aes(x = reorder(CATEGORY, n), y = n)) +
geom_col(fill = "#00a3a6", color = "black") +
geom_label(aes(label = n)) +
coord_flip() +
theme_inrae() +
labs(y = "Nombre de publications", x = "Catégorie JCR")
# Chunk 16
table_disciplines_auteurs <- table_auteurs %>%
filter(etbx_oui_non %in% c("oui", "temporaire", "oui / BSA")) %>%
select(auteur, discipline) %>%
filter(auteur %in% liste_auteurs_etbx) %>%
drop_na()
calcul_discipline <- function(x) {
df <- data.frame(auteur = liste_auteurs_etbx[str_detect(x, liste_auteurs_etbx)] %>% gsub("^\\.|\\.$", "", .) %>% unique())
df %>%
inner_join(table_disciplines_auteurs, by = "auteur") %>%
pull(discipline) %>%
unique() %>%
paste(collapse = " / ")
}
tab_disciplines <- bind_rows(
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(disciplines = calcul_discipline(reference_complete)) %>%
mutate(nb_disciplines = str_split(disciplines, " / ")[[1]] %>% length()) %>%
ungroup(),
ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(disciplines = calcul_discipline(reference_complete)) %>%
mutate(nb_disciplines = str_split(disciplines, " / ")[[1]] %>% length()) %>%
ungroup()
) %>% filter(nb_disciplines > 1)
ggplot(tab_disciplines, aes(x = nb_disciplines)) +
geom_histogram(fill = "#00a3a6", color = "black", binwidth = 1) +
theme_inrae() +
scale_y_continuous(breaks = seq(0, 40, 2)) +
scale_x_continuous(breaks = c(0,2,3)) +
labs(x = "Nombre de disciplines impliquées sur une production scientifique", y = "Fréquence")
# Chunk 17
mono_dis <- bind_rows(
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
mutate(disciplines = calcul_discipline(reference_complete)) %>%
mutate(nb_disciplines = str_split(disciplines, " / ")[[1]] %>% length()),
ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
mutate(disciplines = calcul_discipline(reference_complete)) %>%
mutate(nb_disciplines = str_split(disciplines, " / ")[[1]] %>% length())
) %>%
filter(nb_copubli > 1 & nb_disciplines == 1)
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete)
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete))
solo <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
filter(nb_copubli == 1)
solo
solo <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
filter(nb_copubli == 1) %>%
ungroup()
solo
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete))
solo <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
ungroup() %>%
filter(nb_copubli == 1)
solo
solo <- ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
ungroup() %>%
filter(nb_copubli == 1)
solo
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x")
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
ungroup()
mono_dis <- bind_rows(
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
mutate(disciplines = calcul_discipline(reference_complete)) %>%
mutate(nb_disciplines = str_split(disciplines, " / ")[[1]] %>% length()),
ANX4$i_2_chap_ouvrages %>%
clean_names() %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
mutate(disciplines = calcul_discipline(reference_complete)) %>%
mutate(nb_disciplines = str_split(disciplines, " / ")[[1]] %>% length())
) %>%
filter(nb_copubli > 1 & nb_disciplines == 1)
mono_dis
ANX4$i_1_articles_sctfq
41+30+28+22+6+3+2+2+13+14+18+1+6+14+5+15
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x")
ANX4$i_1_articles_sctfq %>%
clean_names() %>%
filter(axe_3 == "x") %>%
select(reference_complete) %>%
rowwise() %>%
mutate(nb_copubli = calcul_nb_copubli(reference_complete)) %>%
ungroup() %>%
filter(nb_copubli == 1)
20+2+5+1+13+3+9+1+11+1+4+2+5
20+2+5+1+13+3+9+1+11+1+4+2+5
20+13+11+5
41+30+28+22
install.packages(c("bit", "bit64", "Cairo", "car", "conquer", "data.table", "dendextend", "dimensionsR", "ggiraph", "ggspatial", "gt", "leafem", "mapview", "mice", "officer", "parsnip", "processx", "quantreg", "R.methodsS3", "R.oo", "R.utils", "renv", "rvest", "servr", "shinycssloaders", "showtext", "skimr", "spatialwidget", "SQUAREM", "websocket", "workflows", "zip"))
install.packages("mapdeck")
library(IDEATools)
example(IDEATools)
example(importIDEA)
IDEAdata$metadata
IDEAdata$metadata
IDEAdata$dataset
titanic <- system.file("extdata/titanic.xlsx", package = "tidyxl")
readxl::read_excel(titanic)
titanic <- system.file("extdata/titanic.xlsx", package = "tidyxl")
titanic
install.packages("tidyxl")
titanic <- system.file("extdata/titanic.xlsx", package = "tidyxl")
titanic
titanic <- system.file("extdata/titanic.xlsx", package = "tidyxl")
readxl::read_excel(titanic)
x <- xlsx_cells(titanic)
dplyr::glimpse(x)
library(tidyxl)
x <- xlsx_cells(titanic)
dplyr::glimpse(x)
x
x <- xlsx_cells("../../CASDAR_ACTION/Traitements IDEA/calculateurs anonymysés/Calculateur IDEA4 -Agri 2.xls", sheet = 4)
x <- xlsx_cells("../../CASDAR_ACTION/Traitements IDEA/Calculateur IDEA4 -Agri 2.xlsx", sheet = 4)
x
x %>% filter(is_blank == FALSE)
library(tiydyverse)
library(tidyverse)
x %>% filter(is_blank == FALSE)
x %>% filter(is_blank == FALSE) %>% View()
x
x <- readxl::read_excel("../../CASDAR_ACTION/Traitements IDEA/Calculateur IDEA4 -Agri 2.xlsx", sheet = 4)
x
x <- readxl::read_excel("../../CASDAR_ACTION/Traitements IDEA/EARL DE FEYTCHOLET.xlsx", sheet = 4)
x
x <- readxl::read_excel("../../CASDAR_ACTION/Traitements IDEA/EARL DE FEYTCHOLET.xlsx", sheet = "Saisie et Calculateur")
x
x <- xlsx_cells("../../CASDAR_ACTION/Traitements IDEA/Calculateur IDEA4 -Agri 2.xlsx", sheet = "Saisie et Calculateur")
x
x %>% filter(is_blank == FALSE)
x %>% filter(is_blank == FALSE) %>% Viewx
x %>% filter(is_blank == FALSE) %>% View
View(.[[12]][[19]])
View(x[[12]][[19]])
x
x %>% View
x %>% filter(is_blank == FALSE) %>% View
distinct(x$coef)
distinct(x$style_format)
unique(x$style_format)
x <- xlsx_cells("../../CASDAR_ACTION/Traitements IDEA/Calculateur IDEA4 -Agri 2.xlsx", sheet = "Saisie et Calculateur")
x
View(x)
x %>% filter(adress == "A2")
x %>% filter(address == "A2")
x %>% filter(address == "A2") %>% pull()
x %>% filter(address == "A2") %>% unlist
x <- xlsx_cells("../../CASDAR_ACTION/Traitements IDEA/Calculateur IDEA4 -Agri 2.xlsx", sheet = "Saisie et Calculateur")
tidyxl::xlsx_names(x)
tidyxl::xlsx_names("../../CASDAR_ACTION/Traitements IDEA/Calculateur IDEA4 -Agri 2.xlsx", sheet = "Saisie et Calculateur")
.xmsx_names
.xlsx_names
?xlsx_names
tidyxl::xlsx_names("../../CASDAR_ACTION/Traitements IDEA/Calculateur IDEA4 -Agri 2.xlsx")
xlsx_names("../../CASDAR_ACTION/Traitements IDEA/Calculateur IDEA4 -Agri 2.xlsx")
examples <- system.file("extdata/examples.xlsx", package = "tidyxl")
xlsx_names(examples)
path <- "../../CASDAR_ACTION/Traitements IDEA/Calculateur IDEA4 -Agri 2.xlsx"
xlsx_names(path)
xlsx_names(path)
path <- check_file(path)
out <- xlsx_names_(path)
xlsx_cells(examples)
xlsx_names(path)
seq.int(1, 10, by = 2)
logical(1)
examples <- system.file("extdata/examples.xlsx", package = "tidyxl")
xlsx_names(examples)
path <- ("~/Bureau/Classeur1.xlsx")
examples <- system.file("extdata/examples.xlsx", package = "tidyxl")
xlsx_names(examples)
examples <- system.file("extdata/examples.xlsx", package = "tidyxl")
xlsx_names(path)
examples <- system.file("extdata/examples.xlsx", package = "tidyxl")
xlsx_names(path)
xlsx_names(path)
xlsx_names(path)
xlsx_names(path)
xlsx_names(path) %>% select(formula)
xlsx_names(path) %>% select(formula) %>% pull()
xlsx_names(path) %>% select(formula) %>% pull() %>% str_remove_all("$")
xlsx_names(path) %>% select(formula) %>% pull() %>% str_remove_all("\$")
xlsx_names(path) %>% select(formula) %>% pull() %>% str_remove_all("\\$")
xlsx_names(path) %>% select(formula) %>% pull() %>% str_remove_all("\\$") %>% str_remove_all("\\!")
xlsx_cells(path)
xlsx_cells(path) %>% filter(address == "A1")
xlsx_cells(path, sheet = "Sheet 1") %>% filter(address == "A1")
xlsx_cells(path, sheet = "Feuille1") %>% filter(address == "A1")
xlsx_cells(path, sheet = "Feuille1") %>% filter(address == "A1") %>% select(error:character)
xlsx_cells(path, sheet = "Feuille1") %>% filter(address == "A1") %>% select(error:character) %>% select(-is_empty())
xlsx_cells(path, sheet = "Feuille1") %>% filter(address == "A1") %>% select(error:character) %>% select(is_empty())
?select
?is_empty
xlsx_cells(path, sheet = "Feuille1") %>% filter(address == "A1") %>% select(error:character) %>% pull() %>% na.omit
